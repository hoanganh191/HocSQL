use Dat_Hang

create table KHACHHANG(
	MAKHACHANG VARCHAR(5) PRIMARY KEY,
	TENCONGTY NVARCHAR(40),
	TENGIAODICH NVARCHAR(50),
	DIACHI NVARCHAR(50),
	EMAIL VARCHAR(40),
	DIENTHOAI VARCHAR(13),
	FAX VARCHAR(20)
)

CREATE TABLE NHACUNGCAP(
	MACONGTY VARCHAR(5) PRIMARY KEY,
	TENCONGTY NVARCHAR(40),
	TENGIAODICH NVARCHAR(50),
	DIACHI NVARCHAR(50),
	EMAIL VARCHAR(40),
	DIENTHOAI VARCHAR(13),
	FAX VARCHAR(20)
)

CREATE TABLE LOAIHANG (
	MALOAIHANG VARCHAR(5) PRIMARY KEY,
	TENLOAIHANG NVARCHAR(30)
)

CREATE TABLE MATHANG(
	MAHANG VARCHAR(5) PRIMARY KEY,
	TENHANG NVARCHAR(40),
	MACONGTY VARCHAR(5),
	MALOAIHANG VARCHAR(5),
	SOLUONG INT,
	DONVITINH VARCHAR(10),
	GIAHANG INT,
	CONSTRAINT PK_MACONGTY FOREIGN KEY (MACONGTY) REFERENCES NHACUNGCAP(MACONGTY),
	CONSTRAINT PK_MALOAIHANG FOREIGN KEY (MALOAIHANG) REFERENCES LOAIHANG(MALOAIHANG)
)

CREATE TABLE NHANVIEN (
	MANHANVIEN VARCHAR(5) PRIMARY KEY,
	HO NVARCHAR(20),
	TEN NVARCHAR(20),
	NGAYSINH DATE,
	NGAYLAMVIEC DATE,
	DIACHI NVARCHAR(50),
	DIENTHOAI VARCHAR(13),
	LUONGCOBAN INT,
	PHUCAP INT
)

CREATE TABLE DONDATHANG (
	SOHOADON VARCHAR(10) PRIMARY KEY,
	MAKHACHANG VARCHAR(5),
	MANHANVIEN VARCHAR(5),
	NGAYDATHANG DATE,
	NGAYGIAOHANG DATE,
	NGAYCHUYENHANG DATE,
	NOIGIAOHANG NVARCHAR(30),
	CONSTRAINT PK_MAKHACHHANG FOREIGN KEY (MAKHACHANG) REFERENCES KHACHHANG(MAKHACHANG),
	CONSTRAINT PK_MANHANVIEN FOREIGN KEY (MANHANVIEN) REFERENCES NHANVIEN(MANHANVIEN)


)

CREATE TABLE CHITIETDATHANG(
	SOHOADON VARCHAR(10),
	MAHANG VARCHAR(5),
	GIABAN INT,
	SOLUONG INT,
	MUCGIAMGIA INT,
	PRIMARY KEY (SOHOADON,MAHANG),
	CONSTRAINT PK_SOHOADON FOREIGN KEY (SOHOADON) REFERENCES DONDATHANG(SOHOADON),
	CONSTRAINT PK_MAHANG FOREIGN KEY (MAHANG) REFERENCES MATHANG(MAHANG)
)


 --Bổ sung ràng buộc thiết lập giá trị mặc định bằng 1 cho cột SOLUONG  và bằng 0 cho cột MUCGIAMGIA trong bảng CHITIETDATHANG 
ALTER TABLE CHITIETDATHANG ADD CONSTRAINT DF_SOLUONG DEFAULT 1 FOR SOLUONG
ALTER TABLE CHITIETDATHANG ADD CONSTRAINT DF_MUCGIAMGIA DEFAULT 0 FOR MUCGIAMGIA

--Bổ sung cho bảng DONDATHANG ràng buộc kiểm tra ngày giao hàng và ngày chuyển hàng phải sau hoặc bằng với ngày đặt hàng. 
ALTER TABLE DONDATHANG ADD CONSTRAINT CK_NGAY CHECK (NGAYGIAOHANG >= NGAYDATHANG AND NGAYCHUYENHANG >= NGAYDATHANG)

--Bổ sung ràng buộc cho bảng NHANVIEN để đảm bảo rằng một nhân viên chỉ có thể làm việc trong công ty khi đủ 18 tuổi và không quá 60 tuổi. 
ALTER TABLE NHANVIEN ADD CONSTRAINT CK_TUOI CHECK (DATEDIFF(YY,NGAYSINH,NGAYLAMVIEC) BETWEEN 18 AND 60)
ALTER TABLE NHANVIEN ADD CONSTRAINT CK_TUOI CHECK (YEAR(GETDATE()) - YEAR(NGAYSINH) >= 18 AND YEAR(GETDATE()) - YEAR(NGAYSINH) <= 60)


INSERT INTO KHACHHANG (MAKHACHANG, TENCONGTY, TENGIAODICH, DIACHI, EMAIL, DIENTHOAI, FAX)
VALUES 
('KH001', N'Công ty ABC', N'Nguyễn Văn A', N'Hà Nội', 'abc@gmail.com', '0123456789', '04356789'),
('KH002', N'Công ty XYZ', N'Trần Thị B', N'Đà Nẵng', 'xyz@gmail.com', '0987123456', '05116789'),
('KH003', N'Công ty DEF', N'Lê Văn C', N'Hồ Chí Minh', 'def@gmail.com', '0912123456', '08341234');

INSERT INTO NHACUNGCAP (MACONGTY, TENCONGTY, TENGIAODICH, DIACHI, EMAIL, DIENTHOAI, FAX)
VALUES
('NCC01', N'Công ty Thiết bị X', N'Lê Văn B', N'Hồ Chí Minh', 'nccx@gmail.com', '0987654321', '08356789'),
('NCC02', N'Công ty Điện tử Y', N'Ngô Văn D', N'Hà Nội', 'nccy@gmail.com', '0905678912', '04351234'),
('NCC03', N'Công ty Công nghệ Z', N'Phạm Thị E', N'Đà Nẵng', 'nccz@gmail.com', '0912345678', '05113456');

INSERT INTO LOAIHANG (MALOAIHANG, TENLOAIHANG)
VALUES
('LH01', N'Điện thoại'),
('LH02', N'Máy tính xách tay'),
('LH03', N'Phụ kiện');

INSERT INTO MATHANG (MAHANG, TENHANG, MACONGTY, MALOAIHANG, SOLUONG, DONVITINH, GIAHANG)
VALUES
('MH001', N'iPhone 15', 'NCC01', 'LH01', 100, 'Chiếc', 25000000),
('MH002', N'Samsung Galaxy S23', 'NCC02', 'LH01', 150, 'Chiếc', 20000000),
('MH003', N'MacBook Pro 14', 'NCC03', 'LH02', 50, 'Chiếc', 45000000);

SET DATEFORMAT DMY
INSERT INTO NHANVIEN (MANHANVIEN, HO, TEN, NGAYSINH, NGAYLAMVIEC, DIACHI, DIENTHOAI, LUONGCOBAN, PHUCAP)
VALUES
('NV001', N'Nguyễn', N'Văn C', '10-5-1992', '13-6-2023', N'Hà Nội', '0905123456', 10000000, 2000000),
('NV002', N'Trần', N'Thị D', '26-8-1995', '17-4-2024', N'Hồ Chí Minh', '0913123456', 12000000, 2500000),
('NV003', N'Lê', N'Văn E', '25-1-2003', '21-5-2025', N'Đà Nẵng', '0934123456', 9000000, 1500000);

INSERT INTO DONDATHANG (SOHOADON, MAKHACHANG, MANHANVIEN, NGAYDATHANG, NGAYGIAOHANG, NGAYCHUYENHANG, NOIGIAOHANG)
VALUES
('HD001', 'KH001', 'NV001', '2025-09-22', '2025-09-25', '2025-09-23', N'Hà Nội'),
('HD002', 'KH002', 'NV002', '2025-09-20', '2025-09-24', '2025-09-21', N'Đà Nẵng'),
('HD003', 'KH003', 'NV003', '2025-09-18', '2025-09-22', '2025-09-19', N'Hồ Chí Minh');

INSERT INTO CHITIETDATHANG (SOHOADON, MAHANG, GIABAN, SOLUONG, MUCGIAMGIA)
VALUES
('HD001', 'MH001', 25000000, 2, 0),
('HD001', 'MH002', 20000000, 1, 5),
('HD002', 'MH003', 45000000, 1, 0),
('HD003', 'MH001', 25000000, 3, 10),
('HD003', 'MH002', 20000000, 2, 0);


