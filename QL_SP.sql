CREATE DATABASE QL_SP
USE QL_SP

CREATE TABLE SANPHAM (
	MASP VARCHAR(3) PRIMARY KEY,
	TENSP NVARCHAR(40) UNIQUE,
	KICHTHUOC VARCHAR(2) CHECK (KICHTHUOC IN ('S','M','L','X','XL')),
	MAUSAC NVARCHAR(10)
)

CREATE TABLE NHASANXUAT (
	MANSX VARCHAR(4) PRIMARY KEY,
	TENNSX NVARCHAR(30),
	DIACHI NVARCHAR(30)
)

CREATE TABLE CUNGCAP (
	MANSX VARCHAR(4),
	MASP VARCHAR(3),
	NGAY DATE,
	SOLUONG INT CHECK(SOLUONG > 0),
	PRIMARY KEY(MANSX,MASP),
	CONSTRAINT PK_MANSX FOREIGN KEY (MANSX) REFERENCES NHASANXUAT(MANSX),
	CONSTRAINT PK_MASP FOREIGN KEY (MASP) REFERENCES SANPHAM(MASP)
)

INSERT INTO SANPHAM VALUES 
('001',N'Áo cộc họa tiết','S','Xanh'),
('002',N'Quần dài trơn','S','Be'),
('003',N'Quần đùi trên gối','M','Xanh'),
('004',N'Quần ngố họa tiết','L','Đen'),
('005',N'Quần bò ống','XL','Đen'),
('006',N'Áo cộc trơn','M','Tím')

INSERT INTO NHASANXUAT VALUES 
('SX01',N'Thành Đông',N'Hà Nội'),
('SX02',N'Hải Hà',N'Hưng Yên'),
('SX03',N'Chiến thắng',N'Hải Phòng'),
('SX04',N'Hưng Bền',N'Hà Nội')

INSERT INTO CUNGCAP VALUES
('SX01','001','1/1/2024',50),
('SX01','006','3/20/2024',20),
('SX02','002','1/1/2024',10),
('SX02','003','1/25/2024',30),
('SX03','002','1/1/2024',40),
('SX03','005','3/22/2024',50),
('SX04','006','1/19/2024',10),
('SX04','003','1/2/2024',100)

--Viết câu lệnh sửa bảng CUNGCAP thêm 1 cột mới là cột GHICHU.
ALTER TABLE CUNGCAP ADD GHICHU NVARCHAR(40)

--Tạo truy vấn đưa ra những nhà cung cấp đã cung cấp tổng số lượng nhiều hơn tổng số lượng của nhà cung cấp SX01.
SELECT CUNGCAP.MANSX,TENNSX,DIACHI,SUM(SOLUONG) AS TONGSOLUONG
FROM CUNGCAP JOIN NHASANXUAT ON CUNGCAP.MANSX = NHASANXUAT.MANSX
GROUP BY CUNGCAP.MANSX,TENNSX,DIACHI
HAVING SUM(SOLUONG) > (SELECT SUM(SOLUONG) FROM CUNGCAP WHERE MANSX = 'SX01' )

--Tạo truy vấn đưa ra những sản phẩm chưa có trong bảng CUNGCAP.
SELECT * FROM SANPHAM WHERE MASP NOT IN (SELECT MASP FROM CUNGCAP )
